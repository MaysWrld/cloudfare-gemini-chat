// ... (在 sendMessage 函数中)

// 1. 捕获用户消息元素 (不在此处滚动)
const userMessageDiv = appendMessage('user', message); 

// ...
// 3. 创建呼吸思考框
const aiThinkingMessage = document.createElement('div');
aiThinkingMessage.classList.add('message', 'ai-message', 'ai-thinking'); 
chatBox.appendChild(aiThinkingMessage);

// 【v5.7 核心修改】：平滑滚动到 AI 思考中消息
const AI_OFFSET = 20; // 留出 20px 的顶部空间

// 使用 setTimeout 确保 DOM 已经更新了新添加元素的位置 (offsetTop)
setTimeout(() => { 
    if (chatBox.scrollHeight > chatBox.clientHeight) {
        const targetScrollTop = aiThinkingMessage.offsetTop - AI_OFFSET;
        // 使用 v5.6 留下的 smoothScrollTo 函数进行平滑动画
        smoothScrollTo(chatBox, targetScrollTop); 
    }
}, 50);

setTimeout(() => {
    aiThinkingMessage.textContent = '思考中...'; 
}, 100);

// ... (fetch 和 typing 逻辑保持不变)
