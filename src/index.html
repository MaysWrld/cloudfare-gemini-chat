<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark"> 
    <title id="pageTitle">AI 助手 v6.4</title> <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2d000/svg' viewBox='0 0 100 100'><text y='-.1em' x='-.05em' font-size='90'>✨</text></svg>">
    <style>
        /* =================================================== */
        /* === 颜色变量定义：深浅模式切换的核心 (V5.1) === */
        /* =================================================== */
        :root {
            /* Light Mode Variables */
            --bg-main: #f0f4f9;
            --bg-card: #ffffff;
            --bg-input: #f8f9fa;
            --text-main: #3c4043;
            --text-header: #202124;
            --border-main: #e8eaed;
            --color-user: #e6f4ea;
            --color-ai: #f1f3f4;
            --color-system-bg: #fff2e0;
            --color-system-text: #ea8600;
            --color-code-bg: #e8e8e8;
            --color-code-lang: #4285f4;
            --color-focus-blue: #8ab4f8;
            --color-brand-blue: #1a73e8;
            --color-brand-blue-rgb: 26, 115, 232; 
        }

        /* 深色模式：根据设备设置覆盖颜色变量 */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-main: #121212;
                --bg-card: #202020;
                --bg-input: #303030;
                --text-main: #e0e0e0;
                --text-header: #f5f5f5;
                --border-main: #444444;
                --color-user: #3f4b5e; 
                --color-ai: #292929;
                --color-system-bg: #4a3e2a; 
                --color-system-text: #fcc203; 
                --color-code-bg: #2d2d2d;
                --color-code-lang: #79a6fe;
                --color-focus-blue: #5b92e5;
                --color-brand-blue: #5b92e5;
                --color-brand-blue-rgb: 91, 146, 229; 
            }
        }
        
        /* =================================================== */
        /* === 布局和基础样式：V6.4 响应性修复 === */
        /* =================================================== */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
        body { font-family: 'Google Sans', 'Roboto', Arial, sans-serif; background-color: var(--bg-main); display: flex; justify-content: center; align-items: center; color: var(--text-main); }
        
        .chat-container { 
            width: 100%; 
            height: 100%; 
            max-width: 960px; 
            background-color: var(--bg-card); 
            border-radius: 0; 
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2); 
            display: flex; 
            flex-direction: column; 
            min-height: initial; 
            overflow: hidden; 
        }
        
        @media (min-width: 961px) { .chat-container { height: 90vh; border-radius: 28px; } }
        
        /* 头部样式（保持不变） */
        .header { 
            padding: 16px 24px; 
            background-color: var(--bg-card); 
            border-bottom: 1px solid var(--border-main); 
            color: var(--text-header); 
            font-size: 1.5em; 
            font-weight: 500; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            flex-shrink: 0; 
        }
        .header-title { font-weight: 500; }
        .header-icon { font-size: 1em; } 

        /* 新建聊天按钮样式（保持不变） */
        .input-area .new-chat-icon-button {
            background: none;
            color: var(--text-main);
            border: 1px solid var(--border-main);
            width: 44px; 
            height: 44px; 
            border-radius: 50%; 
            cursor: pointer;
            font-size: 1.5em; 
            font-weight: 300; 
            transition:
